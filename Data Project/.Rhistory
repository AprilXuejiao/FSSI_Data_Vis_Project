true = "Social Services",
false = "Other activities"))
## binding for use down below
Revenue1617_long <- rbind(Other_Revenue1617_long,
SocServ_Revenue1617_long)
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
# traceorder = "reversed",
tracegroupgap = 100),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
# traceorder = "reversed",
tracegroupgap = 10),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
traceorder = "reversed+grouped",
tracegroupgap = 10),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
traceorder = "grouped",
tracegroupgap = 10),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
traceorder = "grouped",
tracegroupgap = 10),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
traceorder = "reversed+reversed",
tracegroupgap = 10),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
traceorder = "reversed",
tracegroupgap = 10),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
traceorder = "grouped+reversed",
tracegroupgap = 10),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
# traceorder = "grouped+reversed",
tracegroupgap = 10),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
# traceorder = "grouped+reversed",
tracegroupgap = 5),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
# traceorder = "grouped+reversed",
tracegroupgap = 2),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
# traceorder = "grouped+reversed",
tracegroupgap = 5),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
traceorder = "reversed+grouped",
tracegroupgap = 5),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
traceorder = "reversed",
tracegroupgap = 5),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
# traceorder = "reversed",
tracegroupgap = 5),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
traceorder = "reversed",
tracegroupgap = 5),
margin = list(t = 50, b = 20))
ggplotly(gg_SocServ_Revenue1617,
tooltip = "text",
legendgroup = "legendgroup") %>%
layout(font = list(family = FSSIfont,
size = 12))
ggplotly(gg_SocServ_Revenue1617,
tooltip = "text",
legendgroup = "legendgroup") %>%
layout(font = list(family = FSSIfont,
size = 12))
Revenue16 <- summarise(group_by(VCOSS_ACNC_16,
main_activity = main_activity_2016),
government_grants = sum(government_grants_2016,
na.rm =  TRUE),
donations_and_bequests = sum(donations_and_bequests_2016,
na.rm =  TRUE),
all_other_revenue = sum(all_other_revenue_2016,
na.rm = TRUE),
total_revenue = sum(total_revenue_2016,
na.rm = TRUE))
Revenue16$Year <- 2016
Revenue17 <- summarise(group_by(VCOSS_ACNC_17,
main_activity = main_activity),
government_grants = sum(government_grants_2017,
na.rm = TRUE),
donations_and_bequests = sum(donations_and_bequests_2017,
na.rm = TRUE),
all_other_revenue = sum(all_other_revenue_2017,
na.rm = TRUE),
total_revenue = sum(total_revenue_2017,
na.rm = TRUE))
Revenue17$Year <- 2017
Revenue1617 <- rbind(Revenue16, Revenue17)
## All other sectors
Other_Revenue1617 <- filter(Revenue1617,
!str_detect(main_activity, regex("social services",
ignore_case = TRUE)))
Other_Revenue1617_long <- pivot_longer(Other_Revenue1617,
-c(main_activity, Year, total_revenue),
names_to = "revenue_source",
values_to = "revenue_amount")
Total_Other_Revenue1617_long <- summarise(group_by(Other_Revenue1617_long,
revenue_source, Year),
revenue_amount = sum(revenue_amount))
Total_Other_Revenue1617_long$main_activity <- "Other Sectors"
# plot
gg_Other_Revenue1617 <- ggplot(ungroup(Total_Other_Revenue1617_long),
aes(x = as.ordered(Year),
y = revenue_amount,
colour = str_clean_wrap(revenue_source, 18),
group = revenue_source,
legendgroup = main_activity,
text = paste(sep = "\n",
str_clean_wrap(revenue_source),
dollar(revenue_amount)))) +
geom_point() +
geom_line(stat = "identity") +
scale_y_continuous("Revenue amount",
labels = dollar,
limits = c(0, NA)) +
scale_x_discrete("Year",
expand = c(0.05, 0.05)) +
scale_color_manual("",
values = FSSIQualPal(3)) +
theme_minimal() +
theme(panel.grid.minor = element_blank())
pl_Other_Revenue1617 <- ggplotly(gg_Other_Revenue1617,
tooltip = "text",
legendgroup = "legendgroup") %>%
layout(font = list(family = FSSIfont,
size = 12),
legend = list(itemclick = "toggleothers",
itemdoubleclick = "toggle"))
## Social Services
SocServ_Revenue1617 <- filter(Revenue1617,
str_detect(main_activity, regex("social services",
ignore_case = TRUE)))
SocServ_Revenue1617_long <- pivot_longer(SocServ_Revenue1617,
-c(main_activity, Year, total_revenue),
names_to = "revenue_source",
values_to = "revenue_amount")
SocServ_Revenue1617_long <- mutate(group_by(SocServ_Revenue1617_long,
main_activity, Year),
revenue_proportion = revenue_amount / sum(revenue_amount,
na.rm = TRUE),
soc_serv_bool = if_else(str_detect(main_activity,
regex("social services",
ignore_case = TRUE)),
true = "Social Services",
false = "Other activities"))
gg_SocServ_Revenue1617 <- ggplot(SocServ_Revenue1617_long,
aes(x = as.ordered(Year),
y = revenue_amount,
colour = str_clean_wrap(revenue_source, 18),
group = revenue_source,
legendgroup = main_activity,
text = paste(sep = "\n",
str_clean_wrap(revenue_source),
dollar(revenue_amount)))) +
geom_point() +
stat_summary(fun.y = sum, geom = "line") +
scale_y_continuous("Revenue amount",
labels = dollar,
limits = c(0, NA)) +
scale_x_discrete("Year",
expand = c(0.05, 0.05)) +
scale_color_manual("",
values = rev(FSSIQualPal(6)[4:6])) +
theme_minimal() +
theme(panel.grid.minor = element_blank())
pl_SocServ_Revenue1617 <- ggplotly(gg_SocServ_Revenue1617,
tooltip = "text",
legendgroup = "legendgroup") %>%
layout(font = list(family = FSSIfont,
size = 12))
## bring together
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
traceorder = "reversed",
tracegroupgap = 5),
margin = list(t = 50, b = 20))
## This seems like doubling up but it's used below
Other_Revenue1617_long <- mutate(group_by(Other_Revenue1617_long,
main_activity, Year),
revenue_proportion = revenue_amount / sum(revenue_amount,
na.rm = TRUE),
soc_serv_bool = if_else(str_detect(main_activity,
regex("social services",
ignore_case = TRUE)),
true = "Social Services",
false = "Other activities"))
## binding for use down below
Revenue1617_long <- rbind(Other_Revenue1617_long,
SocServ_Revenue1617_long)
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
# traceorder = "reversed",
tracegroupgap = 5),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
traceorder = "reversed+grouped",
tracegroupgap = 5),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
traceorder = "reversed",
tracegroupgap = 5),
margin = list(t = 50, b = 20))
subplot(pl_Other_Revenue1617, pl_SocServ_Revenue1617,
nrows = 1, shareY = TRUE) %>%
layout(title = list(text = "Victorian Social Services Revenue Sources",
standoff = 10,
xref = "canvas",
x = 0.1),
xaxis = list(title = list(text = "Year\nOther Sectors",
font = list(size = 13))),
xaxis2 = list(title = list(text = "Year\nSocial Services",
font = list(size = 13))),
legend = list(title = list(text = "Charity Size",
standoff = 10,
font = list(size = 14)),
itemclick = "toggleothers",
itemdoubleclick = "toggle",
# traceorder = "reversed",
tracegroupgap = 5),
margin = list(t = 50, b = 20))
